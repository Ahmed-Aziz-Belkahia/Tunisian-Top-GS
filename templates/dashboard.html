{% extends "base.html" %}
{% load static %}
{% block title %}
<title>Dashboard - Tunisian Top Gs</title>
{% endblock title %}

{% block head %}
<link rel="stylesheet" href="{% static "styles/chart.css?v=1" %}">
<link rel="stylesheet" href="{% static "styles/dashboard.css?v=1" %}">
<meta name="viewport" content="width=device-width, initial-scale=1">
{% endblock head %}

{% block header %}
{% include "components/navbar.html" %}
{% endblock header %}

{% block main %}
<div class="dashboard-container">
    <div class="dashboard-top">
        <div class="dashboard-top-left">
            <div class="top-left-dash">
                <div class="top-balance">
                    <div class="container-div-balance">
                        <div class="wrap-balance-icn">
                            <span class="title-balance">Students Balance</span>
                        </div>
                        <span class="amount-balance balance" data-balance="{{dashboard.calculate_total_balance}}">
                            {{dashboard.calculate_total_balance}}$
                        </span>
                    </div>

                    <div class="container-div-balance">
                        <div class="wrap-balance-icn">
                            <span class="title-balance">Monthly Objective</span>
                        </div>
                        <span class="amount-balance objectif">{{dashboard.objectif}}$</span>
                    </div>

                    <div class="container-div-balance">
                        <div class="profits-divs">
                            <span class="title-balance">Profits</span>
                            <div class="icons-spans-balance-profits">
                                <svg xmlns="http://www.w3.org/2000/svg" width="9" height="10" viewBox="0 0 9 10" fill="none">
                                    <path d="M5.40914 5.90914L4.04543 7.27284C3.54333 7.77495 2.72926 7.77495 2.22716 7.27284C1.72505 6.77074 1.72505 5.95667 2.22716 5.45457L3.59086 4.09086L0 0.5H9V9.5L5.40914 5.90914Z" fill="#05CD99" />
                                </svg>
                                <span class="icons-up-green" data-change-percentage="{{dashboard.calculate_daily_profits_change_percentage}}">
                                    {{dashboard.calculate_daily_profits_change_percentage}}%
                                </span>
                            </div>
                        </div>
                        <span class="amount-balance-profits profits" data-balance="{{dashboard.calculate_today_profits}}">
                            +${{dashboard.calculate_today_profits}}
                        </span>
                    </div>

                    <div class="container-div-balance">
                        <div class="losses-divs">
                            <span class="title-balance">Losses</span>
                            <div class="icons-spans-balance-losses">
                                <svg xmlns="http://www.w3.org/2000/svg" width="9" height="10" viewBox="0 0 9 10" fill="none">
                                    <path d="M5.40914 4.09086L4.04543 2.72716C3.54333 2.22505 2.72926 2.22505 2.22716 2.72716C1.72505 3.22926 1.72505 4.04333 2.22716 4.54543L3.59086 5.90914L0 9.5H9V0.5L5.40914 4.09086Z" fill="#D83D6C" />
                                </svg>
                                <span class="icons-up-red" data-change-percentage="{{dashboard.calculate_daily_losses_change_percentage}}">
                                    {{dashboard.calculate_daily_losses_change_percentage}}%
                                </span>
                            </div>
                        </div>
                        <span class="amount-balance-losses losses" data-balance="{{dashboard.calculate_today_losses}}">
                            -${{dashboard.calculate_today_losses}}
                        </span>
                    </div>
                </div>
                <div class="charts">
                    <div id="chartLoader" class="chart-loader">
                        <div class="spinner"></div>
                        <span>Loading chart...</span>
                    </div>
                    <canvas id="myChart"></canvas>
                </div>
            </div>
        </div>
        <div class="dashboard-top-right">
            <div class="add-transaction">
                <div class="top-trensac">
                    <div class="transc">
                        <img src="{% static "assets/transaction.png" %}" alt="">
                    </div>
                    <div class="description-transaction">
                        <span class="description-top-transaction"> Add your latest trades to keep tracking your
                            profits and losses and participate in the competition</span>
                    </div>
                </div>
                <div class="check-transaction">
                    <div class="check-bf">
                        <a href="{% url "profile" %}" class="text-check">CHECK YOUR TRANSACTIONS</a>
                    </div>
                    <div class="button-add">
                        <button class="add-transaction-button openmodale button-30">
                            Add Transaction
                            <i data-lucide="move-right"></i>
                        </button>
                    </div>
                </div>
            </div>
            <div class="member-of-month">
                <div class="title-membre">
                    <span class="title-membre-text">Member of the month</span>
                </div>
                <div class="middle-mfm">
                    <div class="left-middle">
                        <a class='top-user-month' href="{% url "user_profile" username=top_user.username %}">
                            <img class="user-picture" src="{{top_user.pfp.url}}" alt="top_user.username">
                            <img class="rank-decoration" src="{% static "assets/8b845fca921819a55e8496fc497aaf36.png" %}" alt="">
                        </a>
                    </div>
                    <div class="right-middle-mfm">
                        <div class="gookie">
                            <div class="groupbagde">
                                <div>
                                    <a href="{% url "user_profile" username=top_user.username %}" class="name-user">{{top_user}}</a>
                                </div>
                                <div class="badges-user">
                                </div>
                            </div>
                            <div>
                                <span class="prgh-tn">Have earned the badge <span class="topG-text">TOP G</span> for being the best Student of the month . </span>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="button-showprofile">
                    <a href="/profile/{{top_user.username}}" class="show-profile-button button-30">
                        Show Profile
                        <i data-lucide="move-right"></i>
                    </a>
                </div>
            </div>
        </div>
    </div>
    <div class="dashboard-bottom">
        <div class="dashboard-bottom-left">
            <div class="last-transaction-container">
                <div class="tt-transaction">
                    <svg xmlns="http://www.w3.org/2000/svg" x="0px" y="0px" width="20" height="20" viewBox="0,0,256,256">
                        <g fill="#ffffff" fill-rule="nonzero" stroke="none" stroke-width="1" stroke-linecap="butt" stroke-linejoin="miter" stroke-miterlimit="10" stroke-dasharray="" stroke-dashoffset="0" font-family="none" font-weight="none" font-size="none" text-anchor="none" style="mix-blend-mode: normal">
                            <g transform="scale(5.12,5.12)">
                                <path d="M25,2c-7.2878,0 -13.78519,3.40209 -18,8.69922v-6.69922c0.0037,-0.2703 -0.10218,-0.53059 -0.29351,-0.72155c-0.19133,-0.19097 -0.45182,-0.29634 -0.72212,-0.29212c-0.55152,0.00862 -0.99193,0.46214 -0.98437,1.01367v10h10c0.36064,0.0051 0.69608,-0.18438 0.87789,-0.49587c0.18181,-0.3115 0.18181,-0.69676 0,-1.00825c-0.18181,-0.3115 -0.51725,-0.50097 -0.87789,-0.49587h-6.48047c3.84527,-4.86929 9.78778,-8 16.48047,-8c11.60953,0 21,9.39047 21,21c0,11.60953 -9.39047,21 -21,21h-0.00977h-1v0.91602c-0.0046,0.05524 -0.0046,0.11077 0,0.16602v0.91797h1c0.00326,0.00002 0.00651,0.00002 0.00977,0h1v-0.02539c12.22684,-0.52549 22,-10.61976 22,-22.97461c0,-12.69047 -10.30953,-23 -23,-23zM24,11v3.05273c-1.732,0.168 -3.13859,0.78089 -4.18359,1.83789c-1.826,1.847 -1.81741,4.34936 -1.81641,4.44336c0,4.302 3.7612,5.13855 6.7832,5.81055c3.235,0.717 5.2168,1.28847 5.2168,3.85547c0,3.93 -4.798,3.999 -5,4c-4.809,0 -4.995,-3.59781 -5,-4.00781l-1,0.00781h-1c0,1.944 1.284,5.51013 6,5.95313v3.04688h2v-3.06445c2.498,-0.306 6,-1.78455 6,-5.93555c0,-4.302 -3.7612,-5.13855 -6.7832,-5.81055c-3.235,-0.717 -5.2168,-1.28928 -5.2168,-3.86328c0,-0.011 0.00577,-1.14542 0.63477,-2.23242c0.803,-1.389 2.27223,-2.09375 4.36523,-2.09375c3.805,0 3.991,3.60472 4,4.01172l2,-0.02539c-0.024,-1.914 -1.132,-5.39902 -5,-5.91602v-3.07031zM2,24v1v0.01172v1h2v-1v-0.01172v-1zM4.09766,27.62305l-1.95508,0.42383l0.21094,0.97656l0.00391,0.01953l0.21094,0.97656l1.95508,-0.42187l-0.21094,-0.97852l-0.00391,-0.01758zM4.88477,31.21484l-1.85742,0.74219l0.36914,0.92773l0.00781,0.01953l0.37109,0.92773l1.85742,-0.74023l-0.37109,-0.92969l-0.00781,-0.01758zM6.29102,34.61328l-1.71289,1.0332l0.51758,0.85742l0.00977,0.01563l0.51758,0.85547l1.71094,-1.0332l-0.51562,-0.85547l-0.00977,-0.01758zM8.26758,37.71289l-1.52344,1.29492l0.64648,0.76172l0.01367,0.01563l0.64648,0.76172l1.52539,-1.29492l-0.64844,-0.76172l-0.01172,-0.01562zM10.75,40.42383l-1.29883,1.52148l0.76172,0.64844l0.01367,0.01367l0.76172,0.64844l1.29883,-1.52148l-0.76172,-0.64844l-0.01367,-0.01367zM13.66016,42.66602l-1.03711,1.70898l0.85547,0.51953l0.01563,0.00977l0.85547,0.51758l1.03711,-1.70898l-0.85547,-0.51953l-0.01562,-0.00977zM16.91016,44.36719l-0.74414,1.85742l0.92773,0.37109l0.01758,0.00781l0.92773,0.37305l0.74414,-1.85742l-0.92773,-0.37109l-0.01758,-0.00781zM20.4043,45.47656l-0.42773,1.95313l0.97656,0.21484l0.01953,0.00391l0.97656,0.21289l0.42773,-1.95312l-0.97656,-0.21484l-0.01953,-0.00391z"></path>
                            </g>
                        </svg>
                    <span class="title-transaction">Last Transactions</span>
                </div>
                <div class="line-seperation"></div>
                <div class="transactions-history">
                    {% if transactions %}
                        {% comment %} {% for transaction in transactions %}
                            {% if transaction.user %}
                                <div class="history-user-transc">
                                    <div class="ianloine">
                                        <div class="profile-picture-container">
                                            <a href="{% url "user_profile" username=transaction.user.username %}">
                                                <img class="profile-user-transaction" src="{{transaction.user.pfp.url}}" alt="">
                                            </a>
                                        </div>
                                        <div class="informations-user">
                                            <div class="name-fser">
                                                <a href="{% url "user_profile" username=transaction.user.username %}" class="foll">{{transaction.user.username}}</a>
                                                {% for badge in transaction.user.badges.all %}
                                                    <img class="profile-user-badges" src="{{badge.icon.url}}" alt="{{badge}}">
                                                {% endfor %}
                                            </div>
                                            <div class="date-badges">
                                                {{transaction.date}}
                                            </div>
                                        </div>
                                    </div>
                                    <div class="data-transaction-info">
                                        <div class="data-transaction">
                                            <span class="data-transaction-text">
                                                {{transaction.pair}} 
                                                <span class="transaction-info-text {% if transaction.type == 'profit' %}profit-background{% else %}loss-background{% endif %}">
                                                    {{transaction.type}}
                                                </span>
                                            </span>
                                        </div>
                                        <div class="transaction-amount-container {% if transaction.type == 'profit' %}profit-background{% else %}loss-background{% endif %}">
                                            <span class="amount-trade">${{transaction.amount}}</span>
                                        </div>
                                    </div>
                                </div>
                            {% endif %}
                        {% endfor %} {% endcomment %}
                    {% else %}
                        <div class="no-transactions-message">
                            <svg xmlns="http://www.w3.org/2000/svg" x="0px" y="0px" width="100" height="100" viewBox="0,0,256,256">
                                <g fill="#ffffff" fill-rule="nonzero" stroke="none" stroke-width="1" stroke-linecap="butt" stroke-linejoin="miter" stroke-miterlimit="10" stroke-dasharray="" stroke-dashoffset="0" font-family="none" font-weight="none" font-size="none" text-anchor="none" style="mix-blend-mode: normal">
                                    <g transform="scale(5.12,5.12)">
                                        <path d="M25,2c-7.2878,0 -13.78519,3.40209 -18,8.69922v-6.69922c0.0037,-0.2703 -0.10218,-0.53059 -0.29351,-0.72155c-0.19133,-0.19097 -0.45182,-0.29634 -0.72212,-0.29212c-0.55152,0.00862 -0.99193,0.46214 -0.98437,1.01367v10h10c0.36064,0.0051 0.69608,-0.18438 0.87789,-0.49587c0.18181,-0.3115 0.18181,-0.69676 0,-1.00825c-0.18181,-0.3115 -0.51725,-0.50097 -0.87789,-0.49587h-6.48047c3.84527,-4.86929 9.78778,-8 16.48047,-8c11.60953,0 21,9.39047 21,21c0,11.60953 -9.39047,21 -21,21h-0.00977h-1v0.91602c-0.0046,0.05524 -0.0046,0.11077 0,0.16602v0.91797h1c0.00326,0.00002 0.00651,0.00002 0.00977,0h1v-0.02539c12.22684,-0.52549 22,-10.61976 22,-22.97461c0,-12.69047 -10.30953,-23 -23,-23zM24,11v3.05273c-1.732,0.168 -3.13859,0.78089 -4.18359,1.83789c-1.826,1.847 -1.81741,4.34936 -1.81641,4.44336c0,4.302 3.7612,5.13855 6.7832,5.81055c3.235,0.717 5.2168,1.28847 5.2168,3.85547c0,3.93 -4.798,3.999 -5,4c-4.809,0 -4.995,-3.59781 -5,-4.00781l-1,0.00781h-1c0,1.944 1.284,5.51013 6,5.95313v3.04688h2v-3.06445c2.498,-0.306 6,-1.78455 6,-5.93555c0,-4.302 -3.7612,-5.13855 -6.7832,-5.81055c-3.235,-0.717 -5.2168,-1.28928 -5.2168,-3.86328c0,-0.011 0.00577,-1.14542 0.63477,-2.23242c0.803,-1.389 2.27223,-2.09375 4.36523,-2.09375c3.805,0 3.991,3.60472 4,4.01172l2,-0.02539c-0.024,-1.914 -1.132,-5.39902 -5,-5.91602v-3.07031zM2,24v1v0.01172v1h2v-1v-0.01172v-1zM4.09766,27.62305l-1.95508,0.42383l0.21094,0.97656l0.00391,0.01953l0.21094,0.97656l1.95508,-0.42187l-0.21094,-0.97852l-0.00391,-0.01758zM4.88477,31.21484l-1.85742,0.74219l0.36914,0.92773l0.00781,0.01953l0.37109,0.92773l1.85742,-0.74023l-0.37109,-0.92969l-0.00781,-0.01758zM6.29102,34.61328l-1.71289,1.0332l0.51758,0.85742l0.00977,0.01563l0.51758,0.85547l1.71094,-1.0332l-0.51562,-0.85547l-0.00977,-0.01758zM8.26758,37.71289l-1.52344,1.29492l0.64648,0.76172l0.01367,0.01563l0.64648,0.76172l1.52539,-1.29492l-0.64844,-0.76172l-0.01172,-0.01562zM10.75,40.42383l-1.29883,1.52148l0.76172,0.64844l0.01367,0.01367l0.76172,0.64844l1.29883,-1.52148l-0.76172,-0.64844l-0.01367,-0.01367zM13.66016,42.66602l-1.03711,1.70898l0.85547,0.51953l0.01563,0.00977l0.85547,0.51758l1.03711,-1.70898l-0.85547,-0.51953l-0.01562,-0.00977zM16.91016,44.36719l-0.74414,1.85742l0.92773,0.37109l0.01758,0.00781l0.92773,0.37305l0.74414,-1.85742l-0.92773,-0.37109l-0.01758,-0.00781zM20.4043,45.47656l-0.42773,1.95313l0.97656,0.21484l0.01953,0.00391l0.97656,0.21289l0.42773,-1.95312l-0.97656,-0.21484l-0.01953,-0.00391z"></path>
                                    </g>
                                </g>
                            </svg>
                            <span> No transactions have been added. </span>
                        </div>
                    {% endif %}
                </div>
            </div>

            <div class="ranking-container">
                <div class="tt-transaction">
                    <svg xmlns="http://www.w3.org/2000/svg" x="0px" y="0px" width="24" height="24" viewBox="0,0,256,256">
                        <g fill="#ffffff" fill-rule="nonzero" stroke="none" stroke-width="1" stroke-linecap="butt" stroke-linejoin="miter" stroke-miterlimit="10" stroke-dasharray="" stroke-dashoffset="0" font-family="none" font-weight="none" font-size="none" text-anchor="none" style="mix-blend-mode: normal">
                            <g transform="scale(5.12,5.12)">
                                <path d="M10.2,48.6c-0.2,0 -0.4,-0.1 -0.6,-0.2c-0.3,-0.2 -0.5,-0.7 -0.4,-1.1l4.4,-16.3l-13.2,-10.8c-0.4,-0.3 -0.5,-0.7 -0.4,-1.1c0.1,-0.4 0.5,-0.7 0.9,-0.7l17,-0.9l6.2,-15.9c0.2,-0.4 0.6,-0.7 1.1,-0.6c0.5,0.1 0.8,0.5 0.8,1v36.1c0,0.3 -0.2,0.7 -0.5,0.8l-14.8,9.5c-0.1,0.1 -0.3,0.2 -0.5,0.2zM25,38.1v0z"></path>
                            </g>
                        </g>
                    </svg>
                    <span class="title-ranking">Leaderboard</span>
                </div>
                <div class="line-seperation"></div>
                <div class="ranking-user">
                    {% for User in top_users %}
                        <div class="user-ranking-list">
                            <div class="profile-user-ranking">
                                <img src="../static/assets/top{{forloop.counter}}.svg" alt="{{User.rank}}" class="ranking-pic">
                                <a class='user-rank-leard' href="{% url "user_profile" username=User.username %}">
                                    <img class="profile-user-pic" src="{{User.pfp.url}}" alt="">
                                </a>
                                <a class='username-rank-leard' href="{% url "user_profile" username=User.username %}" class="profile-user-name">{{ User.username }}</a>
                            </div>
                            <div class="ranking-amount-container">
                                <span class="amount-trade">${{ User.calculate_balance }}</span>
                            </div>
                        </div>
                    {% endfor %}
                </div>
            </div>
        </div>
        <div class="dashboard-bottom-right">
            <div class="tracker-container">
                <div class="coins-tracker">
                    <div class="picture-icon-crypto">
                        <img src="{% static 'assets/crypto-coin-btc-icon.png' %}" alt="BTC" class="crypto-icon">
                    </div>
                    <div class="tracker-title-wrapper">
                        <span class="crypto-tracking-name">BTC</span>
                        <span class="percentage-down-up btc">0%</span>
                    </div>
                    <div class="tracker-chart">
                        <img src="{% static 'assets/chart-orange.svg' %}" alt="BTC">
                    </div>
                    <div class="price-coin">
                        <div class="spinner-crypto btc-spinner"></div>
                        <span class="price-v btc">$0</span>
                    </div>
                </div>

                <div class="coins-tracker">
                    <div class="picture-icon-crypto">
                        <img src="{% static 'assets/xrp.svg' %}" alt="ETH" class="crypto-icon">
                    </div>
                    <div class="tracker-title-wrapper">
                        <span class="crypto-tracking-name">ETH</span>
                        <span class="percentage-down-up eth">0%</span>
                    </div>
                    <div class="tracker-chart">
                        <img src="{% static 'assets/xrp-icon.svg' %}" alt="ETH">
                    </div>
                    <div class="price-coin">
                        <div class="spinner-crypto eth-spinner"></div>
                        <span class="price-v eth">$0</span>
                    </div>
                </div>

                <div class="coins-tracker">
                    <div class="picture-icon-crypto">
                        <img src="{% static 'assets/solana.svg' %}" alt="SOL" class="crypto-icon">
                    </div>
                    <div class="tracker-title-wrapper">
                        <span class="crypto-tracking-name">SOL</span>
                        <span class="percentage-down-up ltc">0%</span>
                    </div>
                    <div class="tracker-chart">
                        <img src="{% static 'assets/chart-gris.svg' %}" alt="SOL">
                    </div>
                    <div class="price-coin">
                        <div class="spinner-crypto ltc-spinner"></div>
                        <span class="price-v ltc">$0</span>
                    </div>
                </div>
            </div>
            <div class="support-container">
                <div class="support-Title">
                    Need Support <i data-lucide="info"></i>
                </div>
                <div class="support-paragraph">
                    <span>If you faced any problem or you need help just feel free to tell us, we are available.</span>
                </div>
                <a href="{% url "contact-us" %}" class="show-profile-button button-30">
                    Contact Us
                    <i data-lucide="move-right"></i>
                </a>
            </div>
        </div>
    </div>
    <!-- Pop Up's -->
    <div id="popupMessage" class="popup-message">
        <div class="flex-pops">
            <img id="popupImage" src="" alt="">
            <span id="popupSpan" class="span-popup"></span>
            <button id="popUpCloseButton" class="pop-up-close-button">Close</button>
        </div>
    </div>
    <div id="ErrorPopupMessage" class="popup-message error">
        <div class="flex-pops">
            <i data-lucide="circle-alert"></i>
            <span id="ErrorPopupSpan" class="span-popup"></span>
            <button id="ErrorPopUpCloseButton" class="pop-up-close-button">Close</button>
        </div>
    </div>
</div>

<!-- Modal -->
{% load widget_tweaks %}

<div class="modale" aria-hidden="true">
    <div class="modal-dialog">
        <a href="#" class="btn-close closemodale" aria-hidden="true">&times;</a>
        <div class="modal-header">
            <span>Add Your Latest Transaction</span>
            <span>We've missed you! Please put your proof to catch up on the ranking.</span>
        </div>
        <div class="modal-body">
            <form id="transactionForm" enctype="multipart/form-data" method="post">
                {% csrf_token %}
                <div class="input-group">
                    <label for="pair">Pair: </label>
                    {{ transactionForm.pair|attr:"placeholder:e.g., BTC/USD" }}
                    <div class="error-message" id="pairError"></div>
                </div>
                <div class="input-group" style="flex-direction: column;">
                    <label for="amount">Amount: </label>
                    {{ transactionForm.amount|attr:"placeholder:e.g., 1000" }}
                    <div class="error-message" id="amountError"></div>
                </div>
                <div class="input-group">
                    <label for="type">Type: </label>
                    {{ transactionForm.type }}
                    <div class="error-message" id="typeError"></div>
                </div>
                <div class="file-upload">
                    <label for="chooseFile">Upload a proof:</label>
                    <div class="file-select">
                        <div class="file-select-button" id="fileName">Choose File</div>
                        <div class="file-select-name" id="noFile">No file chosen...</div>
                        {{ transactionForm.img }}
                        <div class="error-message" id="imgError"></div>
                    </div>
                </div>
                <div class="modal-footer">
                    <button type="submit" class="add-transaction-button THEbutton openmodale button-30">
                        Add Transaction
                        <i data-lucide="move-right"></i>
                    </button>
                </div>
            </form>
        </div>
    </div>
</div>
{% endblock main %}

{% block scripts %}
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<script>
    var course_url_title = "{{course.url_title}}";
</script>
<script src="{% static "js/chart.js?v=1" %}"></script>
<script src="{% static "js/dashboard.js?v=1" %}"></script>
{% endblock scripts %}
